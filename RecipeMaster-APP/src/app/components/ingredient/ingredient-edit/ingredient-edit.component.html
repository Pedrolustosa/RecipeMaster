<div class="container-fluid py-3">
  <div class="row">
    <div class="col-md-9">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-edit me-2"></i>
            {{ 'INGREDIENTS.EDIT.TITLE' | translate }}
          </h5>
        </div>
        
        <div class="card-body">
          <p class="text-muted">{{ 'INGREDIENTS.EDIT.SUBTITLE' | translate }}</p>
          <form [formGroup]="ingredientForm" (ngSubmit)="onSubmit()">
            <ul class="nav nav-tabs mb-3" id="ingredientTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                  <i class="fas fa-info-circle me-2"></i>
                  {{ 'INGREDIENTS.EDIT.TABS.BASIC' | translate }}
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab">
                  <i class="fas fa-dollar-sign me-2"></i>
                  {{ 'INGREDIENTS.EDIT.TABS.DETAILS' | translate }}
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="storage-tab" data-bs-toggle="tab" data-bs-target="#storage" type="button" role="tab">
                  <i class="fas fa-warehouse me-2"></i>
                  {{ 'INGREDIENTS.EDIT.TABS.STORAGE' | translate }}
                </button>
              </li>
            </ul>

            <div class="tab-content" id="ingredientTabContent">
              <div class="tab-pane fade show active" id="basic" role="tabpanel">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="name" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.NAME' | translate }} *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="name" 
                      formControlName="name"
                      [ngClass]="{'is-invalid': submitted && f['name'].errors}"
                    >
                    <div *ngIf="submitted && f['name'].errors" class="invalid-feedback">
                      <div *ngIf="f['name'].errors['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.NAME_REQUIRED' | translate }}
                      </div>
                      <div *ngIf="f['name'].errors['minlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.NAME_MINLENGTH' | translate }}
                      </div>
                      <div *ngIf="f['name'].errors['maxlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.NAME_MAXLENGTH' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="unit" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.UNIT' | translate }} *</label>
                    <mat-form-field class="w-full">
                      <mat-label>{{ 'INGREDIENTS.EDIT.FORM.UNIT' | translate }}</mat-label>
                      <mat-select formControlName="unit">
                        <mat-option *ngFor="let unit of units" [value]="unit.value">
                          {{ 'INGREDIENTS.UNITS.' + unit.key | translate }}
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="ingredientForm.get('unit')?.errors?.['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.UNIT_REQUIRED' | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="col-12">
                    <label for="description" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.DESCRIPTION' | translate }} *</label>
                    <textarea 
                      class="form-control" 
                      id="description" 
                      rows="3" 
                      formControlName="description"
                      [ngClass]="{'is-invalid': submitted && f['description'].errors}"
                    ></textarea>
                    <div *ngIf="submitted && f['description'].errors" class="invalid-feedback">
                      <div *ngIf="f['description'].errors['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.DESCRIPTION_REQUIRED' | translate }}
                      </div>
                      <div *ngIf="f['description'].errors['minlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.DESCRIPTION_MINLENGTH' | translate }}
                      </div>
                      <div *ngIf="f['description'].errors['maxlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.DESCRIPTION_MAXLENGTH' | translate }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Details Tab -->
              <div class="tab-pane fade" id="details" role="tabpanel">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="cost" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.COST' | translate }} *</label>
                    <div class="input-group">
                      <span class="input-group-text">R$</span>
                      <input 
                        type="number" 
                        class="form-control" 
                        id="cost" 
                        formControlName="cost"
                        [ngClass]="{'is-invalid': submitted && f['cost'].errors}"
                      >
                    </div>
                    <div *ngIf="submitted && f['cost'].errors" class="invalid-feedback d-block">
                      <div *ngIf="f['cost'].errors['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.COST_REQUIRED' | translate }}
                      </div>
                      <div *ngIf="f['cost'].errors['min']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.COST_MIN' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="stockQuantity" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.STOCK_QUANTITY' | translate }} *</label>
                    <input 
                      type="number" 
                      class="form-control" 
                      id="stockQuantity" 
                      formControlName="stockQuantity"
                      [ngClass]="{'is-invalid': submitted && f['stockQuantity'].errors}"
                    >
                    <div *ngIf="submitted && f['stockQuantity'].errors" class="invalid-feedback">
                      <div *ngIf="f['stockQuantity'].errors['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.STOCK_QUANTITY_REQUIRED' | translate }}
                      </div>
                      <div *ngIf="f['stockQuantity'].errors['min']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.STOCK_QUANTITY_MIN' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="minimumStockLevel" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.MINIMUM_STOCK' | translate }} *</label>
                    <input 
                      type="number" 
                      class="form-control" 
                      id="minimumStockLevel" 
                      formControlName="minimumStockLevel"
                      [ngClass]="{'is-invalid': submitted && f['minimumStockLevel'].errors}"
                    >
                    <div *ngIf="submitted && f['minimumStockLevel'].errors" class="invalid-feedback">
                      <div *ngIf="f['minimumStockLevel'].errors['required']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.MINIMUM_STOCK_REQUIRED' | translate }}
                      </div>
                      <div *ngIf="f['minimumStockLevel'].errors['min']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.MINIMUM_STOCK_MIN' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="supplierName" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.SUPPLIER' | translate }}</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="supplierName" 
                      formControlName="supplierName"
                      [ngClass]="{'is-invalid': submitted && f['supplierName'].errors}"
                    >
                    <div *ngIf="submitted && f['supplierName'].errors" class="invalid-feedback">
                      <div *ngIf="f['supplierName'].errors['maxlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.SUPPLIER_MAXLENGTH' | translate }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Storage Tab -->
              <div class="tab-pane fade" id="storage" role="tabpanel">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="originCountry" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.ORIGIN' | translate }}</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="originCountry" 
                      formControlName="originCountry"
                      [ngClass]="{'is-invalid': submitted && f['originCountry'].errors}"
                    >
                    <div *ngIf="submitted && f['originCountry'].errors" class="invalid-feedback">
                      <div *ngIf="f['originCountry'].errors['maxlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.ORIGIN_MAXLENGTH' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="storageInstructions" class="form-label">{{ 'INGREDIENTS.EDIT.FORM.STORAGE_INSTRUCTIONS' | translate }}</label>
                    <textarea 
                      class="form-control" 
                      id="storageInstructions" 
                      rows="3" 
                      formControlName="storageInstructions"
                      [ngClass]="{'is-invalid': submitted && f['storageInstructions'].errors}"
                    ></textarea>
                    <div *ngIf="submitted && f['storageInstructions'].errors" class="invalid-feedback">
                      <div *ngIf="f['storageInstructions'].errors['maxlength']">
                        {{ 'INGREDIENTS.EDIT.VALIDATION.STORAGE_INSTRUCTIONS_MAXLENGTH' | translate }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-check form-switch">
                      <input 
                        type="checkbox" 
                        class="form-check-input" 
                        id="isPerishable" 
                        formControlName="isPerishable"
                      >
                      <label class="form-check-label" for="isPerishable">
                        {{ 'INGREDIENTS.EDIT.FORM.IS_PERISHABLE' | translate }}
                      </label>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-check form-switch">
                      <input 
                        type="checkbox" 
                        class="form-check-input" 
                        id="isActive" 
                        formControlName="isActive"
                      >
                      <label class="form-check-label" for="isActive">
                        {{ 'INGREDIENTS.EDIT.FORM.IS_ACTIVE' | translate }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Fixed bottom action buttons -->
            <div class="position-sticky bottom-0 bg-white pt-3 border-top mt-3">
              <div class="d-flex gap-2 justify-content-end">
                <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">
                  <i class="fas fa-times me-2"></i>
                  {{ 'INGREDIENTS.EDIT.FORM.CANCEL' | translate }}
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-2"></i>
                  {{ 'INGREDIENTS.EDIT.FORM.SUBMIT' | translate }}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card bg-light border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-question-circle me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.TITLE' | translate }}
          </h5>
          <hr>
          
          <p><i class="fas fa-check-circle text-success me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.REQUIRED_FIELDS' | translate }}</p>

          <div class="accordion accordion-flush" id="helpAccordion">
            <!-- Informações Básicas -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#basicInfo">
                  <i class="fas fa-info-circle me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.SECTIONS.BASIC_INFO' | translate }}
                </button>
              </h2>
              <div id="basicInfo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.NAME' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.name}}</p>
                  </div>
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.DESCRIPTION' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.description}}</p>
                  </div>
                  <div class="field-help">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.UNIT' | translate }}:</strong>
                    <p class="small text-muted mb-0">{{fieldInstructions.unit}}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Custos e Estoque -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#stockInfo">
                  <i class="fas fa-boxes me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.SECTIONS.COSTS_STOCK' | translate }}
                </button>
              </h2>
              <div id="stockInfo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.COST' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.cost}}</p>
                  </div>
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.STOCK_QUANTITY' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.stockQuantity}}</p>
                  </div>
                  <div class="field-help">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.MINIMUM_STOCK' | translate }}:</strong>
                    <p class="small text-muted mb-0">{{fieldInstructions.minimumStockLevel}}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Fornecedor e Origem -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#supplierInfo">
                  <i class="fas fa-truck me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.SECTIONS.SUPPLIER_ORIGIN' | translate }}
                </button>
              </h2>
              <div id="supplierInfo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.SUPPLIER' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.supplierName}}</p>
                  </div>
                  <div class="field-help">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.ORIGIN' | translate }}:</strong>
                    <p class="small text-muted mb-0">{{fieldInstructions.originCountry}}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Armazenamento -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#storageInfo">
                  <i class="fas fa-warehouse me-2"></i>{{ 'INGREDIENTS.FORM.HELP_TEXTS.SECTIONS.STORAGE' | translate }}
                </button>
              </h2>
              <div id="storageInfo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <div class="field-help mb-2">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.IS_PERISHABLE' | translate }}:</strong>
                    <p class="small text-muted mb-2">{{fieldInstructions.isPerishable}}</p>
                  </div>
                  <div class="field-help">
                    <strong>{{ 'INGREDIENTS.EDIT.FORM.STORAGE_INSTRUCTIONS' | translate }}:</strong>
                    <p class="small text-muted mb-0">{{fieldInstructions.storageInstructions}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="need-help mt-3">
            <p class="small mb-0">
              <i class="fas fa-info-circle me-2"></i>
              {{ 'INGREDIENTS.EDIT.HELP.CONTACT_SUPPORT' | translate }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
